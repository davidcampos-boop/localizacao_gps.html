<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Localização GPS</title>
<style>
       body {
           font-family: Arial, sans-serif;
           margin: 16px;
       }
       h1 {
           font-size: 1.4rem;
           margin-bottom: 8px;
       }
       button {
           padding: 12px 16px;
           font-size: 1rem;
           border: none;
           border-radius: 6px;
           cursor: pointer;
       }
       #btnLocalizar {
           margin-top: 8px;
       }
       #resultado {
           margin-top: 16px;
           padding: 12px;
           border-radius: 6px;
           border: 1px solid #ddd;
       }
       #status {
           margin-top: 8px;
           font-size: 0.95rem;
       }
       .label {
           font-weight: bold;
       }
       #btnCopiar {
           margin-top: 12px;
       }
</style>
</head>
<body>
<h1>Capturar localização</h1>
<p>
       Toque no botão abaixo e permita o acesso à localização do dispositivo.
       Depois é só <strong>copiar</strong> e colar as informações no formulário.
</p>
<button id="btnLocalizar">Obter localização</button>
<div id="resultado" style="display:none;">
<p><span class="label">Endereço:</span><br><span id="endereco"></span></p>
<p><span class="label">Cidade:</span> <span id="cidade"></span></p>
<p><span class="label">Estado:</span> <span id="estado"></span></p>
<p><span class="label">CEP:</span> <span id="cep"></span></p>
<p><span class="label">Latitude:</span> <span id="lat"></span></p>
<p><span class="label">Longitude:</span> <span id="lon"></span></p>
<button id="btnCopiar">Copiar tudo</button>
<p id="status"></p>
</div>
<p id="mensagem"></p>
<script>
       const btnLocalizar = document.getElementById("btnLocalizar");
       const resultado = document.getElementById("resultado");
       const msg = document.getElementById("mensagem");
       const enderecoSpan = document.getElementById("endereco");
       const cidadeSpan = document.getElementById("cidade");
       const estadoSpan = document.getElementById("estado");
       const cepSpan = document.getElementById("cep");
       const latSpan = document.getElementById("lat");
       const lonSpan = document.getElementById("lon");
       const btnCopiar = document.getElementById("btnCopiar");
       const status = document.getElementById("status");
       let enderecoTxt = "";
       let cidadeTxt = "";
       let estadoTxt = "";
       let cepTxt = "";
       let latFmt = "";
       let lonFmt = "";
       function mostrarMensagem(texto) {
           msg.textContent = texto;
       }
       btnLocalizar.addEventListener("click", () => {
           mostrarMensagem("Obtendo localização, aguarde...");
           status.textContent = "";
           resultado.style.display = "none";
           if (!navigator.geolocation) {
               mostrarMensagem("Geolocalização não é suportada neste dispositivo.");
               return;
           }
           navigator.geolocation.getCurrentPosition(success, error, {
               enableHighAccuracy: true,
               timeout: 20000,
               maximumAge: 0
           });
       });
       function success(position) {
           const lat = position.coords.latitude;
           const lon = position.coords.longitude;
           latFmt = lat.toFixed(6);
           lonFmt = lon.toFixed(6);
           latSpan.textContent = latFmt;
           lonSpan.textContent = lonFmt;
           enderecoSpan.textContent = "Buscando endereço aproximado...";
           cidadeSpan.textContent = "";
           estadoSpan.textContent = "";
           cepSpan.textContent = "";
           resultado.style.display = "block";
           mostrarMensagem("");
           const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=jsonv2`;
           fetch(url)
               .then(resp => resp.json())
               .then(data => {
                   if (data) {
                       enderecoTxt = data.display_name || "";
                       const adr = data.address || {};
                       cidadeTxt = adr.city || adr.town || adr.village || adr.suburb || adr.county || "";
                       estadoTxt = adr.state || "";
                       cepTxt = adr.postcode || "";
                       enderecoSpan.textContent = enderecoTxt || "Endereço não encontrado.";
                       cidadeSpan.textContent = cidadeTxt;
                       estadoSpan.textContent = estadoTxt;
                       cepSpan.textContent = cepTxt;
                   } else {
                       enderecoSpan.textContent = "Endereço não encontrado. Use apenas as coordenadas.";
                   }
               })
               .catch(() => {
                   enderecoSpan.textContent = "Não foi possível obter o endereço. Use apenas as coordenadas.";
               });
           btnCopiar.onclick = () => {
               // ORDEM EXATA PARA O POWER AUTOMATE:
               // Endereço ; Cidade ; Estado ; Cep ; Latitude ; Longitude
               const textoCopiar =
                   `${enderecoTxt};${cidadeTxt};${estadoTxt};${cepTxt};${latFmt};${lonFmt}`;
               if (navigator.clipboard && navigator.clipboard.writeText) {
                   navigator.clipboard.writeText(textoCopiar)
                       .then(() => {
                           status.textContent = "Dados copiados. Cole no campo de localização do formulário.";
                       })
                       .catch(() => {
                           status.textContent = "Não foi possível copiar automaticamente. Copie manualmente os dados acima.";
                       });
               } else {
                   status.textContent = "Seu navegador não permite cópia automática. Copie manualmente os dados acima.";
               }
           };
       }
       function error(err) {
           console.warn(err);
           if (err.code === 1) {
               mostrarMensagem("Permita o acesso à localização para continuar.");
           } else if (err.code === 2) {
               mostrarMensagem("Não foi possível obter a localização. Verifique o GPS ou a internet.");
           } else if (err.code === 3) {
               mostrarMensagem("Tempo excedido ao obter a localização. Tente novamente.");
           } else {
               mostrarMensagem("Erro ao obter a localização.");
           }
       }
</script>
</body>
</html>
